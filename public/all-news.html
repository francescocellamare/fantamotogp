<!DOCTYPE html>
<html lang="en">

<head>
  <title>All News - FantaMotoGP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark border-bottom">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="./assets/logo.png" alt="Logo" class="logo me-2" style="width: 40px; height: auto;">
        <span>FantaMotoGP</span>
      </a>
    </div>
  </nav>

  <div class="container mt-4">
    <h1 class="mb-4">All News</h1>
    <div id="news-list">
      <!-- All news will be displayed here -->
    </div>
  </div>

  <!-- Firebase Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore, collection, query, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDlLVyt-XFNbnnwtkpbpO7MbfcEczBFPXM",
      authDomain: "fantamotogp-e46cd.firebaseapp.com",
      projectId: "fantamotogp-e46cd",
      storageBucket: "fantamotogp-e46cd.firebasestorage.app",
      messagingSenderId: "1082694838160",
      appId: "1:1082694838160:web:637714386327bcc8027515",
      measurementId: "G-LSRZLRP39Z"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function fetchAllNews() {
      const newsCollection = collection(db, 'news');
      const newsQuery = query(newsCollection, orderBy("timestamp", "desc"));

      try {
        const newsSnapshot = await getDocs(newsQuery);
        const newsListContainer = document.getElementById('news-list');

        if (!newsSnapshot.empty) {
          newsSnapshot.forEach(doc => {
            const newsItem = doc.data();

            // Format the timestamp into a readable format
            const timestamp = new Date(newsItem.timestamp.seconds * 1000);
            const humanReadableTimestamp = timestamp.toLocaleString();

            // Create a news card for each news item
            const newsCard = document.createElement('div');
            newsCard.classList.add('card', 'mb-3');

            newsCard.innerHTML = `
              <div class="card-body">
                <h5 class="card-title">${newsItem.title}</h5>
                <p class="card-text">${newsItem.recap}</p>
                <small class="text-muted">${humanReadableTimestamp}</small>
              </div>
            `;

            newsListContainer.appendChild(newsCard);
          });
        } else {
          newsListContainer.innerHTML = '<p class="text-muted">No news available</p>';
        }
      } catch (error) {
        console.error("Error fetching all news:", error);
        document.getElementById('news-list').innerHTML = '<p class="text-muted">Failed to load news</p>';
      }
    }

    // Fetch all news when the page loads
    window.onload = fetchAllNews;
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
</body>

</html>
